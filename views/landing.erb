<style>
html { background-color: black; color: white; }
form { }
textarea { font-size: x-large; width: 100%; }
</style>

<% if Redis.new.get('ONION') != nil && ENV['BOX'] == 'true' %>
<button type='button' onclick='$("#onion").toggle()' class='material-icons'>my_location</button>
<div id='onion' style='display: none;'>
  <div id='qrcode' style='background-color: white; padding: 2%; text-align: center;'></div>
  <script>$('#qrcode').qrcode('<%= Redis.new.get('ONION') %>');</script>
  <input value='<%= Redis.new.get('ONION') %>' disabled style='width: 100%;'>
</div>
<% end %>

<h1 id='bar' style='width: 100%; text-align: center; background-color: white; margin-top: 10%;'>
<% if !/.onion/.match(request.host) %>
<span id='title' style='background-color: white; font-size: x-large; color: black; padding: 2%;'><%= request.host %></span>
<% else %>
<span id='title' style='background-color: white; font-size: x-large; color: black; padding: 2%;'><%= `hostname` %></span>
<% end %>
</h1>
<div style='width: 100%; text-align:center;'>

<% if Redis.new.get('LOCKED') == nil && params.has_key?(:edit) %>
  <textarea name='landing' placeholder='landing html...' style='width: 100%; height: 80%;'><%= LANDING[OPTS[:domain]] %></textarea>
  <button>save</button>
<% end %>


<% if params.has_key?(:w) ||  params.has_key?(:cha) %>
    <% if params.has_key? :cha %>
      <h3>we sent you a pin.</h3>
      <input type='hidden' name='cha' value='<%= params[:cha] %>'>
      <h1><input type='tel' name='pin' maxlength='6' placeholder='PIN' style='text-align: center;'></h1>
      <h1><button>AUTHORIZE!</button></h1>
    <% else %>
      <h1><input type='tel' name='usr' id='tel' maxlength='10' placeholder='PHONE' style='text-align: center;' pattern="[0-9]{10}"></h1>
      <h1><button>AUTHORIZE</button></h1>
    <% end %>
<% else %>

  <% if params[:landing] == 'edit' %>
      <textarea name='landing' placeholder='landing html...' style='width: 100%; height: 80%;'><%= LANDING[OPTS[:domain]] %></textarea>
      <button>save</button>     
  <% end %>
      
  <% if params.has_key?(:quick) %>
     <input type='hidden' name='quick[type]' value='<%= params[:quick] %>'>
     <input type='hidden' name='quick[id]' value='<%= Time.now.utc.to_i %>'>
     <div style='position: absolute; bottom: 0; width: 100%;'>
      <h1><input type='tel' name='quick[phone]' maxlength='10' placeholder='phone' style='text-align: center; width: 100%;' pattern="[0-9]{10}"></h1>
      <% if QUICK.has_key? params[:quick] %>
        <%= erb QUICK[params[:quick]] %>
      <% else %>
        <textarea name='quick[rx]' placeholder='how can we help?' style='height: 80%;'></textarea>
      <% end %>
      <button style='width: 80%; background-color: green; color: white;'>ASK</button></div>
  <% end %>
  <% if !params.has_key?(:quick) && ENV['BOX'] == 'true' %>
      <h1><input type='text' name='login[username]' maxlength='20' placeholder='username' style='text-align: center;'></h1>
      <h1><input type='text' name='login[password]' maxlength='20' placeholder='password' style='text-align: center;'></h1>
      <h1><button>login</button></h1>
  <% end %>
<% end %>
    <%= erb LANDING[request.host] || '' %>
</div>
