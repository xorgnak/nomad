<style>
#canvas { width: 100%; height: 100%; position: fixed; left: 0; top: 0; z-index: -2; } 
#head > * { vertical-align: middle; }
#config input { width: 100%; }
#title {
color: white;
text-shadow: 0px 0px 1px black;
text-shadow: 0px 0px 2px black;
}
button {
color: white;
text-shadow: 0px 0px 1px black;
text-shadow: 0px 0px 2px black;
background-color: rgba(0,0,0,0.0);
border: thick solid white;
padding: 3%;
}
#state > * { vertical-align: middle; }
#give > * {vertical-align: middle; }
</style>

<meta name="viewport" content="initial-scale=1, maximum-scale=1">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="manifest" href="https://<%= OPTS[:domain] %>/manifest.webmanifest" crossorigin="use-credentials" />
<script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/jquery.qrcode@1.0.3/jquery.qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<canvas id='canvas'></canvas> 
<form action'/' method='POST'>
  <input type='file' id='pic-file' style='position: fixed; top: -100px;' name='config[pic]'>
  <h1 id='head' style='width: 100%; text-align: center;'>
    <button id='menu' class='material-icons' style='font-size: xx-large; position: fixed; top: 0; left: 0;'>menu</button>
    <span id='title' style='text-align: center; display: inline-block;'><%= OPTS[:domain]%></span>
    <button id='show-badge' class='material-icons' style='font-size: xx-large; position: fixed; top: 0; right: 0;'>qr_code_2</button>
  </h1>
  
  

  
  <div id='config' style='background-color: black; display: none;'>
    <h3><input type='text' name='config[name]' placeholder='NAME'></h3>
    <h3><input type='text' name='config[pitch]' placeholder='PITCH'></h3>
    <h3><input type='text' name='config[link]' placeholder='LINK'></h3>
    <h3><button id='pic' style='width: 100%; height: 30%;'>PIC</button></h3>
    <h3 style='text-align: center;'><button>SAVE</button></h3>
  </div>
  
  <div id='badge' style='background-color: black; display: none; width: 100%;'>
    <%= stats(@id) %>
    <div id='qrcode-wrap' style='width: 100%; text-align: center;'>
      <div id="qrcode" style='padding: 2%; border: thick solid black; background-color: white;'></div>
      <%= awards(@id) %>
      <%= badges(@id) %>
    </div>
  </div>
  <div id='magic' style='background-color: black; display: none;'>
    <input type='hidden' name='give[target]' value='<%= @id %>'>
      <h3 id='give' style='width: 100%; text-align: center; background-color: white; color: black;'>
	<select class='material-icons' name='give[type]' style='width: 15%; padding: 0;'>
	  <option class='material-icons' selected disabled>military_tech</option>
	<% U.new(@id).badges.members.to_a.each do |badge| %>
	<option class='material-icons' value='<%= badge %>'><%= badge %></option>
	<% end %>
      </select>
	<input type='text' name='give[desc]' placeholder='for...'>
	<button class='material-icons'>send</button>
      </h3>
  </div>
  
  <fieldset id='view' style='background-color: rgba(255,255,255,0.1); color: white; height: 40%; position: fixed; bottom: 0; left: 0; width: 90%; text-shadow: 0px 0px 2px black; overflow-y: scroll;'>
    <legend><span id='icon' class='material-icons'>waving_hand</span>welcome</legend>
    <p style='background-color: rgba(0,0,0,0.4);'>
      <code id='log' style='width: 100%; color: orange;'>booting...</code>
    </p>
    <div id='info'>
      <h3 id='state' style='width: 100%; text-align: center;'>
	<span id='gp'><%= '0' %></span><span class='material-icons' style='margin-right: 1%; padding: 0 1% 0 1%;'>savings</span>
	<span class='material-icons' style='margin: 0 1% 0 1%; padding: 1%;'>directions_run</span><span id='xp'><%= '0' %></span>
      </h3>
      <p>thanks for giving us a try.</p>
      <p>Scan proPedicab.com qrcodes to collect rewards and connect with the city around you.</p>
      <p>Customize your <span class='material-icons'>menu</span> to give your brand a boost.</p>
      <p>Share your <span class='material-icons'>qr_code_2</span> with others to connect.</p>
      <p>Your local agent can sell you <span class='material-icons'>savings</span> and help you with any sponsorship, marketing, scheduling, or any other issues.</p>
    </div>
  </fieldset>
  
</form>
<script>
  function log(s) { $('#log').text(s); console.log(s); }
$(document).on('click', '#menu', function(e) { e.preventDefault(); $('#view').toggle(); $('#config').toggle(); });
$(document).on('click', '#show-badge', function(e) { e.preventDefault(); $('#view').toggle(); $('#badge').toggle(); });
$(document).on('click', '#pic', function(e) { e.preventDefault(); $('#pic-file').click(); });

<%= erb :scan %>
<%= erb :sha %>
<%= erb :coin %>
</script>
