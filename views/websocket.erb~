window.onload = function(){
    (function(){
	const formToJSON = (elements) =>
	      [].reduce.call(
		  elements,
		  (data, element) => {
		      data[element.name] = element.value;
		      return data;
		  },
		  {},
	      );
        var ws       = new WebSocket('ws://' + window.location.host + '/ws');
	ws.onopen    = function()  { console.log('websocket opened'); };
	ws.onclose   = function()  { console.log('websocket closed'); }
	ws.onmessage = function(m) { console.log('websocket message: ' +  m.data); };
	
        var sender = function(f){
	    var input     = document.getElementById('input');
	    input.onclick = function(){ input.value = "" };
	    f.onsubmit    = function(){
		var h = {
		    input: input.value,
		    u: '<%= params[:u] %>',
		    zone: '<%= params[:z] %>',
		    form: formToJSON($('form')[0]);
		}
		ws.send(JSON.stringify(h));
		input.value = "";
		return false;
	    }
	}(document.getElementById('form'));
    })();
}
